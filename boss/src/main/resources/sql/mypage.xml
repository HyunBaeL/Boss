<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boss.dao.MypageDao">
	
	<!-- 내 주문내역 불러오기 -->
	<select id="myoders" parameterType="String" resultType="orders">
		select * from orders where mEmail = #{mEmail}
	</select>	
	
	<!-- 주문번호안에 pid목록들 -->
	<select id="listProduct" parameterType="String"
		resultType="Map">
		select *
		from orderdetail
		join orders
		using (oid)
		where mEmail = #{mEmail}
	</select>
	
	<!-- order 객체 -->
	<select id="myorders" parameterType="String" resultType="orders">
		select * from orders where mEmail = #{mEmail}
	</select>
	
	
	<!-- 내 리뷰 불러오기 -->	
	<select id="myreviews" parameterType="String" resultType="review">
		select * from review where mEmail = #{mEmail} and rDrop = 'N'
	</select>
	
	<!-- 내 QnA 불러오기 -->
	<select id="myqnas" parameterType="String" resultType="qnaBoard">
		select * from qnaBoard where mEmail = #{mEmail} and qnaDrop = 'N'
	</select>
	
	<!-- 리뷰 삭제 -->
	<update id="mypageDeleteReview" parameterType="String">
		update review set rdrop = 'Y' where rid = #{rid}
	</update>
	
	<!-- 배송상태 변경 ( 환불 요청 ) -->
	<update id="refund" parameterType="String">
		update orderdetail set odstatus = 2 where odid = #{odid}
	</update>
	
	<!-- odid를 통해서 주문상세 구해오기 -->
	<select id="myorderDetail" parameterType="String" resultType="orderDetail">
		select * from orderDetail where odid = #{odid}
	</select>
	
	<!-- oid를 통해서 주문상세 구해오기 -->
	<select id="mypageOrderDetail" parameterType="String" resultType="orderDetail">
		select * from orderDetail where oid = #{oid}
	</select>

	<!-- 내 상품문의 ask 불러오기 (이메일을 통해) -->
	<select id="productlist" parameterType="String" resultType="Map">
		select *
		from askboard
		join Product ON askboard.pid = Product.pid
		where
		askboard.mEmail = #{mEmail} AND askboard.askdrop = 'N'
	</select>

</mapper>